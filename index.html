<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador G-code - Vase Mode</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="main-center">
    <h1 data-text="Generador de G-code - Vase Mode">Generador de G-code - Vase Mode</h1>
    <form id="paramForm">
    </form>
    <div class="responsive-grid">
<div class="col">
        <div class="col-inner">
          <h2>Parámetros</h2>
          <label style="display:flex; align-items:center; gap:3px;">Grosor de pared (mm): <input type="number" id="pared" value="0.4" step="0.05"></label>
          <label style="display:flex; align-items:center; gap:3px;">Altura de capa (mm): <input type="number" id="alturaCapa" value="0.3" step="0.05"></label>
          <label style="display:flex; align-items:center; gap:3px;">Tamaño cama X (mm): <input type="number" id="camaX" value="300" step="1"></label>
          <label style="display:flex; align-items:center; gap:3px;">Tamaño cama Y (mm): <input type="number" id="camaY" value="300" step="1"></label>
          <label style="display:flex; align-items:center; gap:3px;">Temperatura extrusor (°C): <input type="number" id="tempExtrusor" value="200" step="1"></label>
          <label style="display:flex; align-items:center; gap:3px;">Temperatura cama (°C): <input type="number" id="tempCama" value="60" step="1"></label>
          <label style="display:flex; align-items:center; gap:3px;">Multiplicador de extrusión (%) <input type="number" id="flujo" value="100" step="1" min="50" max="200"></label>
          <label style="display:flex; align-items:center; gap:3px;">Flujo máximo (mm²/s): <input type="number" id="flujoMax" value="2.4" step="0.1"></label>
          <label style="display:flex; align-items:center; gap:3px;">Fan de capa (%) <input type="number" id="fanCapa" value="100" step="1" min="0" max="100"></label>
<label style="display:flex; align-items:center; gap:3px;">Vueltas de translación por capa: <input type="number" id="vueltasTranslacion" value="15" step="0.1" min="-20" max="20"></label>
<label style="display:flex; align-items:center; gap:3px;">Rotación (%) <input type="number" id="moduloDesfase" value="2" step="0.01" min="-50" max="50"></label>
<label style="display:flex; align-items:center; gap:3px;">Diámetro giro de translación (mm): <input type="number" id="diametroGiro" value="5" step="0.1" min="0.1" max="50"></label>
          <button type="button" id="downloadBtn">Descargar G-code</button>
          <button type="button" id="previewBtn">Previsualizar</button>
        </div>
      </div>
<div class="col">
        <div class="col-inner">
          <h2>Generatriz</h2>
          <div class="canvas-row">
            <canvas id="topViewCanvas" width="400" height="400"></canvas>
          </div>
        </div>
      </div>
<div class="col">
       <div class="col-inner">
         <h2>Directriz</h2>
        <div class="canvas-row">
          <canvas id="perfilCanvas" width="400" height="400"></canvas>
          </div>
        </div>
      </div>
<div class="col">
  <div class="col-inner">
    <h2>Parámetros de revolución ⌀</h2>
    <div class="revolucion-slider-grid">
      <div class="slider-col slider-col-right">
        <label for="alturaSlider" class="slider-label">Altura (mm)</label>
        <input type="range" id="alturaSlider" min="100" max="350" value="150" step="5" orient="vertical">
        <input type="number" id="alturaSlider_val" class="slider-value" min="100" max="350" value="150" step="5" style="width: 60px; margin-top: 8px; text-align: center;">
      </div>
      <div id="slidersPerfil" class="sliders-perfil">
        <div class="slider-perfil-row slider-perfil-horizontal">
          <span class="slider-perfil-label">Top</span>
          <input type="range" min="50" max="300" value="75" id="perfil0" class="slider-perfil" step="5">
          <input type="number" id="perfil0_val" class="slider-value slider-value-horizontal" min="50" max="300" value="75" step="5">
        </div>
        <div class="slider-perfil-row slider-perfil-horizontal">
          <span class="slider-perfil-label">3/4</span>
          <input type="range" min="50" max="300" value="50" id="perfil1" class="slider-perfil" step="5">
          <input type="number" id="perfil1_val" class="slider-value slider-value-horizontal" min="50" max="300" value="50" step="5">
        </div>
        <div class="slider-perfil-row slider-perfil-horizontal">
          <span class="slider-perfil-label">Mitad</span>
          <input type="range" min="50" max="300" value="100" id="perfil2" class="slider-perfil" step="5">
          <input type="number" id="perfil2_val" class="slider-value slider-value-horizontal" min="50" max="300" value="100" step="5">
        </div>
        <div class="slider-perfil-row slider-perfil-horizontal">
          <span class="slider-perfil-label">1/4</span>
          <input type="range" min="50" max="300" value="120" id="perfil3" class="slider-perfil" step="5">
          <input type="number" id="perfil3_val" class="slider-value slider-value-horizontal" min="50" max="300" value="120" step="5">
        </div>
        <div class="slider-perfil-row slider-perfil-horizontal">
          <span class="slider-perfil-label">Base</span>
          <input type="range" min="50" max="300" value="75" id="perfil4" class="slider-perfil" step="5">
          <input type="number" id="perfil4_val" class="slider-value slider-value-horizontal" min="50" max="300" value="75" step="5">
        </div>
      </div>
    </div>
  </div>
</div>
 </div>

  <!-- Modal de previsualización 3D -->
<div id="previewModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(20,20,20,0.85); z-index:9999; justify-content:center; align-items:center;">
  <div class="preview-modal-content" style="position:relative; width:100vw; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:flex-start;">
    <button id="closePreviewModal" style="position:absolute; top:12px; right:16px; background:transparent; border:none; font-size:2em; color:#1976d2; cursor:pointer;">&times;</button>
    <h2 style="margin-top:32px; margin-bottom:18px; text-align:center;">Previsualización 3D</h2>
    <div id="canvasContainer" style="flex:1; width:100vw; display:flex; align-items:center; justify-content:center;">
      <canvas id="preview3dCanvas" style="max-width:100vw; max-height:calc(100vh - 90px); aspect-ratio:1/1; width:auto; height:auto;"></canvas>
    </div>
  </div>
</div>

  <script src="script.js"></script>
<script>
// Abrir modal y renderizar solo al click
const previewBtn = document.getElementById('previewBtn');
const previewModal = document.getElementById('previewModal');
const closePreviewModal = document.getElementById('closePreviewModal');
const previewCanvas = document.getElementById('preview3dCanvas');
function resizePreviewCanvas() {
  // Altura disponible: toda la ventana menos título y margen superior
  const vh = window.innerHeight;
  const vw = window.innerWidth;
  const headerSpace = 90; // px (título + botón cerrar + margen)
  const size = Math.min(vw, vh - headerSpace);
  previewCanvas.width = size;
  previewCanvas.height = size;
  previewCanvas.style.width = size + 'px';
  previewCanvas.style.height = size + 'px';
}
previewBtn.addEventListener('click', () => {
  previewModal.style.display = 'flex';
  resizePreviewCanvas();
  setTimeout(() => { drawPreview3D && drawPreview3D(); }, 100);
});
closePreviewModal.addEventListener('click', () => {
  previewModal.style.display = 'none';
});
window.addEventListener('resize', () => {
  if (previewModal.style.display === 'flex') {
    resizePreviewCanvas();
    setTimeout(() => { drawPreview3D && drawPreview3D(); }, 100);
  }
});
window.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') previewModal.style.display = 'none';
});
</script>
</body>
</html>
